plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}

version = '1.0.2'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17) 
    }
}

repositories {
    mavenCentral()
    maven { url 'https://repo.dmulloy2.net/repository/public/' }
    maven { url 'https://repo.codemc.io/repository/maven-public/' }
    maven { url 'https://repo.skriptlang.org/releases' }
    maven { url 'https://hub.spigotmc.org/nexus/content/repositories/snapshots/' }
    maven { url 'https://repo.papermc.io/repository/maven-public/' }
    maven { url 'https://jitpack.io' }
}

dependencies {
    compileOnly 'com.github.SkriptLang:Skript:2.10.0'
    implementation 'org.yaml:snakeyaml:1.29'
    compileOnly 'org.spigotmc:spigot-api:1.16.5-R0.1-SNAPSHOT'
    implementation 'org.quartz-scheduler:quartz:2.3.2'  // Changed to implementation for shading
    compileOnly 'org.apache.commons:commons-lang3:3.12.0' 
    compileOnly 'net.kyori:adventure-api:4.14.0'
    compileOnly 'net.kyori:adventure-text-minimessage:4.14.0'
    compileOnly 'net.kyori:adventure-platform-bukkit:4.3.0'
    compileOnly 'com.github.MilkBowl:VaultAPI:1.7'
    implementation 'com.coreoz:wisp:2.4.0'
    implementation 'ch.eitchnet:cron:1.6.2'  // Add this dependency
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
    sourceCompatibility = '17' 
    targetCompatibility = '17' 
}

shadowJar {
    archiveFileName = 'PwingSkriptAddon.jar'
    relocate 'org.quartz', 'com.pwing.pwingskriptaddon.libs.quartz'
    relocate 'com.coreoz.wisp', 'com.pwing.pwingskriptaddon.libs.wisp'
    relocate 'fc.cron', 'com.pwing.pwingskriptaddon.libs.cron'  // Add this relocation
    
    dependencies {
        include(dependency('org.quartz-scheduler:quartz'))
        include(dependency('com.coreoz:wisp'))
        include(dependency('ch.eitchnet:cron'))  // Include this dependency
    }
    
    minimize {
        exclude(dependency('com.coreoz:wisp'))
        exclude(dependency('ch.eitchnet:cron'))  // Exclude from minimization
    }
}

build.dependsOn shadowJar
